"use strict";(self.webpackChunktagspaces=self.webpackChunktagspaces||[]).push([[6651],{26651:(e,t,r)=>{r.d(t,{Z:()=>M});var a=r(67294),n=r(24011),o=r(91647),i=r(58094),s=r(30030),c=r(18720),l=r(45355),d=r(80713),g=r(14890),u=r(3530),p=r(57866),m=r(7419),h=r(44187),y=r(59975),f=r(1075),E=r(6121),b=r(55829),D=r(36808),v=r(53777),Z=r(94968);e=r.hmd(e);var S,C=r(25108);function P(e){const{style:t,theme:r,directories:n,showDirectories:g,showDetails:h,showDescription:S,showTags:P,getCellContent:k,isAppLoading:L,currentDirectoryColor:F,currentDirectoryTags:R,currentDirectoryDescription:M,currentDirectoryPath:x,lastThumbnailImageChange:T,openRenameEntryDialog:w,lastBackgroundImageChange:N,gridPageLimit:O,currentPage:I,files:G}=e,B=G.length,J=O&&G.length>O,A=J?Math.ceil(B/O):10,j=(0,a.useRef)(null),z=(0,a.useRef)(I),U=(0,a.useRef)(!1),H=(0,a.useRef)((0,b.BK)(x,T)),W=(0,a.useRef)((0,b.jN)(x,N));let K;if(J){const e=(z.current-1)*O;K=G.slice(e,e+O)}else K=G;const[,q]=(0,a.useReducer)((e=>e+1),0);(0,a.useEffect)((()=>{e.isMetaLoaded||U.current||(U.current=!0,D.Z.listMetaDirectoryPromise(e.currentDirectoryPath).then((t=>{U.current=!1,e.setIsMetaLoaded(!0);const r=V(),a=Q(t),n=$(t);return X([...r,...a,...n]),!0})).catch((e=>C.error(e))))}),[z.current,e.isMetaLoaded,G]),(0,a.useEffect)((()=>{H.current=(0,b.BK)(e.currentDirectoryPath,e.lastThumbnailImageChange),q()}),[e.currentDirectoryPath,e.lastThumbnailImageChange]),(0,a.useEffect)((()=>{W.current=(0,b.jN)(e.currentDirectoryPath,e.lastBackgroundImageChange),q()}),[e.currentDirectoryPath,e.lastBackgroundImageChange]),(0,a.useEffect)((()=>{z.current=I,j&&j.current&&(j.current.scrollTop=0)}),[e.currentLocationPath,e.currentDirectoryPath,e.searchResultCount]);const Y=(e,t)=>{const r={...e};let a=(0,p.getThumbFileLocationForFile)(e.path,D.Z.getDirSeparator(),!1);return a&&t.some((e=>a.endsWith(e.path)))&&(r.thumbPath=a,(D.Z.haveObjectStoreSupport()||D.Z.haveWebDavSupport())&&(a&&a.startsWith("/")&&(a=a.substring(1)),a=D.Z.getURLforPath(a,604800),a&&(r.thumbPath=a))),r},$=e=>K.map((t=>Promise.resolve({[t.path]:Y(t,e)}))),V=()=>n.map((async e=>{if(e.name===u.Z.metaFolder)return Promise.resolve({[e.path]:void 0});const t=await D.Z.listMetaDirectoryPromise(e.path),r=(0,p.getMetaFileLocationForDir)(e.path,D.Z.getDirSeparator()),a=(0,p.getThumbFileLocationForDirectory)(e.path,D.Z.getDirSeparator());let n;if(t.some((e=>a.endsWith(e.path)))){const t=D.Z.haveObjectStoreSupport()||D.Z.haveWebDavSupport()?D.Z.getURLforPath(a):a;n={...e,thumbPath:t}}return t.some((e=>r.endsWith(e.path)))&&-1===e.path.indexOf(u.Z.metaFolder+D.Z.getDirSeparator())?(0,b.jy)(n||e,r):Promise.resolve({[e.path]:n})})),Q=e=>K.map((t=>{const r=(0,p.getMetaFileLocationForFile)(t.path,D.Z.getDirSeparator());return e.some((e=>r.endsWith(e.path)))&&-1===t.path.indexOf(u.Z.metaFolder+D.Z.getDirSeparator())?(0,b.jy)(t,r):Promise.resolve({[t.path]:void 0})})),X=e=>{const t=e=>{};Promise.all(e.map((e=>e.catch(t)))).then((e=>(_(e),!0))).catch((e=>{C.error("err updateEntries:",e)}))},_=t=>{const r=[];t.forEach((e=>{if(e)for(const[t,a]of Object.entries(e))a&&r.push(a)})),r.length>0&&e.updateCurrentDirEntries(r)},ee=(0,p.extractDirectoryName)(e.currentDirectoryPath,D.Z.getDirSeparator()),te=F||"transparent",re=n.length+" folder(s) and "+B+" file(s) found";let ae="";M&&(ae=(0,b.Yi)(M,200));const ne=S&&M;return a.createElement("div",{style:{height:"100%",background:`${te}`}},a.createElement("div",{ref:j,onContextMenu:t=>e.onContextMenu(t),onClick:t=>e.onClick(t),style:{height:"100%",overflowY:u.Z.isFirefox?"auto":"overlay",backgroundImage:'url("'+W.current+'")',backgroundSize:"cover",backgroundRepeat:"no-repeat"}},a.createElement(s.ZP,{container:!0,spacing:2},a.createElement(s.ZP,{item:!0,xs:12,style:{height:70}}),h&&a.createElement(s.ZP,{item:!0,xs:12},a.createElement("div",{style:{marginLeft:10,marginRight:10,marginTop:0,marginBottom:0,height:150,position:"relative"}},a.createElement(c.Z,{style:{display:"flex",alignItems:"center",overflow:"auto",padding:10,marginRight:160,width:"fit-content",background:r.palette.background.default,borderRadius:8,color:r.palette.text.primary}},a.createElement(i.Z,{title:m.Z.t("core:renameDirectory")},a.createElement(l.Z,{style:{fontSize:"1.5rem"},onClick:w},ee)),P?a.createElement("span",{style:{paddingLeft:5}},R&&R.map((e=>a.createElement(E.Z,{isReadOnlyMode:!0,tag:e,tagMode:"display"})))):a.createElement(f.Z,{tags:R})),a.createElement(c.Z,{style:{paddingBottom:5,background:r.palette.background.default,marginTop:-12,marginRight:160,padding:10,borderRadius:8,width:"fit-content",color:r.palette.text.primary}},(n.length>0||K.length>0)&&a.createElement(o.Z,{style:{fontSize:"0.9rem"}},re),!S&&ae&&a.createElement(i.Z,{title:m.Z.t("core:filePropertiesDescription")},a.createElement(o.Z,{style:{fontSize:"0.8rem",wordBreak:"break-all"}},ae))),a.createElement(i.Z,{title:m.Z.t("core:thumbnail")},a.createElement("div",{style:{height:140,width:140,backgroundImage:'url("'+H.current+'")',backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"top center",position:"absolute",top:0,right:0}})))),ne&&a.createElement(s.ZP,{item:!0,xs:12,style:{backgroundColor:r.palette.background.default,marginTop:h?0:10,marginLeft:25,marginRight:10,padding:2,borderRadius:5}},a.createElement(v.i,{content:M,readOnly:!0,dark:"dark"===r.palette.mode,currentFolder:x,lightMode:!0}))),a.createElement("div",{style:t,"data-tid":"perspectiveGridFileTable"},1===z.current&&n.map(((t,a)=>(0,Z.cw)(t,a,k,e.classes,r,g,e.isReadOnlyMode,e.desktopMode,e.singleClickAction,e.currentLocation,e.selectedEntries,e.setSelectedEntries,e.lastSelectedEntryPath,e.directoryContent,e.openFsEntry,e.openFileNatively,e.loadDirectoryContent,e.setFileContextMenuAnchorEl,e.setDirContextMenuAnchorEl,e.showNotification,e.moveFiles,e.clearSelection))),K.map(((t,a,n)=>(0,Z.cw)(t,a,k,e.classes,r,g,e.isReadOnlyMode,e.desktopMode,e.singleClickAction,e.currentLocation,e.selectedEntries,e.setSelectedEntries,e.lastSelectedEntryPath,e.directoryContent,e.openFsEntry,e.openFileNatively,e.loadDirectoryContent,e.setFileContextMenuAnchorEl,e.setDirContextMenuAnchorEl,e.showNotification,e.moveFiles,e.clearSelection,a===n.length-1))),!L&&K.length<1&&n.length<1&&a.createElement("div",{style:{textAlign:"center"}},!ne&&a.createElement("div",{style:{position:"relative",marginBottom:150}},a.createElement(y.Z,{isFile:!1})),a.createElement(o.Z,{style:{padding:15,color:r.palette.text.secondary}},m.Z.t("core:noFileFolderFound")),!u.Z.isCordova&&a.createElement(o.Z,{style:{color:r.palette.text.secondary}},m.Z.t("core:dragAndDropToImport"))),!L&&K.length<1&&n.length>=1&&!g&&a.createElement("div",{style:{textAlign:"center"}},!ne&&a.createElement("div",{style:{position:"relative",marginBottom:150}},a.createElement(y.Z,{isFile:!1})),a.createElement(o.Z,{style:{padding:15,color:r.palette.text.secondary}},m.Z.t("core:noFileButFoldersFound")),!u.Z.isCordova&&a.createElement(o.Z,{style:{color:r.palette.text.secondary}},m.Z.t("core:dragAndDropToImport")))),J&&a.createElement(i.Z,{title:re},a.createElement(d.Z,{style:{left:15,bottom:65,zIndex:1100,position:"absolute",backgroundColor:r.palette.background.default,opacity:.97,border:"1px solid lightgray",borderRadius:5,padding:3},count:A,page:z.current,onChange:(t,r)=>{z.current=r,e.setIsMetaLoaded(!1),j&&j.current&&(j.current.scrollTop=0)}})),!h&&!J&&(n.length>0||K.length>0)&&a.createElement("div",{style:{padding:15,bottom:10}},a.createElement(o.Z,{style:{fontSize:"0.9rem",color:r.palette.text.primary}},re))))}function k(e){return{isAppLoading:(0,h.hg)(e),currentDirectoryColor:(0,h.ju)(e),searchResultCount:(0,h.V0)(e),currentDirectoryTags:(0,h.qy)(e),isMetaLoaded:(0,h.UK)(e),currentDirectoryDescription:(0,h.if)(e),lastBackgroundImageChange:(0,h.GP)(e),lastThumbnailImageChange:(0,h.lS)(e),lastSelectedEntryPath:(0,h.Fv)(e)}}function L(e){return(0,g.DE)({updateCurrentDirEntries:h.Nw.updateCurrentDirEntries,setIsMetaLoaded:h.Nw.setIsMetaLoaded},e)}(S="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&S(e),("undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e})(P,"useRef{containerEl}\nuseRef{page}\nuseRef{metaLoadedLock}\nuseRef{folderTmbPath}\nuseRef{folderBgndPath}\nuseReducer{[, forceUpdate](0)}\nuseEffect{}\nuseEffect{}\nuseEffect{}\nuseEffect{}");const F=(e,t)=>t.theme===e.theme&&JSON.stringify(t.lastBackgroundImageChange)===JSON.stringify(e.lastBackgroundImageChange)&&JSON.stringify(t.lastThumbnailImageChange)===JSON.stringify(e.lastThumbnailImageChange)&&t.currentDirectoryPath===e.currentDirectoryPath&&t.isMetaLoaded===e.isMetaLoaded&&t.showDirectories===e.showDirectories&&t.showDetails===e.showDetails&&t.showDescription===e.showDescription&&t.showTags===e.showTags&&t.thumbnailMode===e.thumbnailMode&&t.entrySize===e.entrySize&&t.gridPageLimit===e.gridPageLimit&&t.searchResultsCount===e.searchResultsCount&&t.currentDirectoryDescription===e.currentDirectoryDescription&&JSON.stringify(t.files)===JSON.stringify(e.files)&&JSON.stringify(t.directories)===JSON.stringify(e.directories)&&JSON.stringify(t.settings)===JSON.stringify(e.settings)&&JSON.stringify(t.selectedEntries)===JSON.stringify(e.selectedEntries)&&JSON.stringify(t.currentDirectoryColor)===JSON.stringify(e.currentDirectoryColor),R=(0,n.$j)(k,L)(a.memo(P,F)),M=R;var x,T;(x="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(x.register(P,"GridPagination","/Users/na/TagSpaces/tsbuilder/mainrepo/app/perspectives/grid-perspective/components/GridPagination.tsx"),x.register(k,"mapStateToProps","/Users/na/TagSpaces/tsbuilder/mainrepo/app/perspectives/grid-perspective/components/GridPagination.tsx"),x.register(L,"mapActionCreatorsToProps","/Users/na/TagSpaces/tsbuilder/mainrepo/app/perspectives/grid-perspective/components/GridPagination.tsx"),x.register(F,"areEqual","/Users/na/TagSpaces/tsbuilder/mainrepo/app/perspectives/grid-perspective/components/GridPagination.tsx"),x.register(R,"default","/Users/na/TagSpaces/tsbuilder/mainrepo/app/perspectives/grid-perspective/components/GridPagination.tsx")),(T="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&T(e)}}]);
//# sourceMappingURL=6651.bundle.js.map